<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Edge-Path Bundling</title>

    <style>
        #VizContainer {
            width: 100%;
            height: 70vh;
            padding: 0;
        }

        #Canvas {

        }
    </style>
  </head>
<body>
    <div class="container overflow-hidden" >
        <div class="row gx-6 py-3">
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button" onclick="clickDatasetButton('./simple.json')">Simple Example</button>
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button">Cubes 3</button>
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button" onclick="clickDatasetButton('./cubes.json')">Cubes 4</button>
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button" onclick="clickDatasetButton('./airlines.json')">Airlines</button>
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button" onclick="clickDatasetButton('./migrations.json')">Migrations</button>
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button" onclick="clickDatasetButton('./airtraffic.json')">Airtraffic</button>
            </div>
        </div>
        <div class="row">
            <div id='VizContainer'>
                <canvas id='Canvas'></canvas>
            </div>
        </div>
        <div class="row gx-6 py-3">
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button" onclick="clickBundleButton()">Bundle all</button>
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <button class="btn btn-outline-primary" type="button" onclick="clickReset()">Reset</button>
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <label for="customRange1" class="form-label" id='label1'>Distortion factor:</label>
                <input type="range" class="form-range" min="1" max="5" step="0.5" oninput="maxDistortionChanged(this.value)"  id="customRange1">
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <label for="customRange2" class="form-label" id='label2'>Weight factor:</label>
                <input type="range" class="form-range" min="1" max="4" step="0.5" oninput="distWeightsChanged(this.value)"  id="customRange2">
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <label for="customRange3" class="form-label" id='label3'>Bundle strength:</label>
                <input type="range" class="form-range" min="1" max="4" step="1" oninput="bundleStrengthChanged(this.value)" id="customRange3">
            </div>
            <div class="col-4 col-md-2 d-grid mx-auto">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="isInteractive">
                    <label class="form-check-label" for="flexSwitchCheckDefault">Interactive</label>
                </div>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="isAnimated">
                    <label class="form-check-label" for="flexSwitchCheckDefault">Animated</label>
                </div>
            </div>
        </div>
    </div>
    


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>

<script src='math.min.js'></script>
<script src='https://d3js.org/d3.v5.min.js'></script>
<script src='fibonacci_heap.js'></script>
<script src='ebp.js'></script>
<script>

var svg;
var EPB;
var Renderer;
var width, height;

window.onload = function () {
    resetInput()
    Render = new Render('#Canvas');
    
    var container = document.getElementById('VizContainer');
    var canvas = document.getElementById('Canvas');
    
    ({ width, height } = container.getBoundingClientRect());
    
    canvas.width = width;
    canvas.height = height;

    d3.json('./simple.json').then(function(data){
        bundled = false;

        nodes = data['nodes'];
        links = data['links'];

        EBP = new EdgePathBundling(nodes, links, width, height);
    }).then(function(){
        EBP.drawGraphStraight(Render);
    });
}

function resetInput() {
    document.getElementById("customRange1").value = 2;
    document.getElementById("customRange2").value = 2;
    document.getElementById("customRange3").value = 1;
    document.getElementById("isInteractive").checked = false;
    document.getElementById("isAnimated").checked = false;

    document.getElementById('label1').innerHTML = 'Distortion: 2.0'
    document.getElementById('label2').innerHTML = 'Weight factor: 2.0'
    document.getElementById('label3').innerHTML = 'Bundle strength: 1'
}

function clickDatasetButton(path) {
    resetInput()
    d3.json(path).then(function(data){
        bundled = false;

        nodes = data['nodes'];
        links = data['links'];

        EBP = new EdgePathBundling(nodes, links, width, height);
    }).then(function(){
        EBP.drawGraphStraight(Render);
    });
}

function clickBundleButton() {
    EBP.bundle();
    
    if(document.getElementById("isAnimated").checked)
        EBP.animate(Render, 100, 5);
    else 
        EBP.drawGraphBundled(Render);
}


function clickReset() {
    EBP.drawGraphStraight(Render);
}

function bundleStrengthChanged(value) {

    document.getElementById('label3').innerHTML = 'Bundle strength: ' + value

    EBP.setBundlingStrength(value);
    EBP.sub(value);
    
    if(document.getElementById("isAnimated").checked)
        EBP.animate(Render, 10, 200);
    else 
        EBP.drawGraphBundled(Render);
}

function distWeightsChanged(value) {
    document.getElementById('label2').innerHTML = 'Weight factor: ' + value;

    EBP.setWeight(value);

    if(document.getElementById("isInteractive").checked){ 
        EBP.bundle();
        if(document.getElementById("isAnimated").checked)
            EBP.animate(Render, 10, 200);
        else 
            EBP.drawGraphBundled(Render);
    }
}

function maxDistortionChanged(value) {
    document.getElementById('label1').innerHTML = 'Distortion: ' + value;
    EBP.setDistortion(value);
    
    if(document.getElementById("isInteractive").checked){ 
        EBP.bundle();
        if(document.getElementById("isAnimated").checked)
            EBP.animate(Render, 10, 200);
        else 
            EBP.drawGraphBundled(Render);
    }
}



// function clickDatasetButton(path) {
//     loadDataset(path, svg)
// }

// function clickReset() {
//     resetBundling(svg)
// }

// function bundleStrengthChanged(value) {
//     setBundleStrength(value);
//     drawBundled(svg);
// }

// function distWeightsChanged(value) {
//     updateWeights(value);
//     drawBundled(svg);
// }

// function maxDistortionChanged(value) {
//     setMaxDistortion(value);
//     drawBundled(svg);
// }

</script>
</html>